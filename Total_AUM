create table nancy.AUM as 
with cte as (
SELECT distinct a.client_code,a.order_id, a.amount,a.transaction_type,a.scheme_code,a.data_source,a.transaction_date::date,b.scheme_plan,c.user_type,c.city,c.state,c.nation
FROM "dbo_wms_s3"."portfolio_transactions" a
LEFT JOIN (select distinct scheme_code,scheme_plan from "dbo_angels"."dbo_wms"."scheme_plan") b on a.scheme_code=b.scheme_code
LEFT JOIN (Select distinct party_code,case when b2c='Y' then 'B2C' when b2c='N' then 'B2B' else NULL END as user_type,city,state,nation from "dbo_angels"."product_analytics"."sn_clientkyc" ) c on a.client_code=c.party_code
where  a.dt<>'2023-10-12' and a.dt<>'2023-10-25' and client_code='A901918')

select sum(amount),transaction_type from cte group by 2

------------------------------- orders
with cte as 
(select distinct a.client_code,a.id as order_id,a.amount,a.transaction_type,a.investment_type,a.scheme_code,a.created_ts::Date as transaction_date,b.scheme_plan,c.user_type,c.city,c.state,c.nation from dbo_angels.dbo_wms.orders a 
LEFT JOIN (select distinct scheme_code,scheme_plan from "dbo_angels"."dbo_wms"."scheme_plan") b on a.scheme_code=b.scheme_code
LEFT JOIN (Select distinct party_code,case when b2c='Y' then 'B2C' when b2c='N' then 'B2B' else NULL END as user_type,city,state,nation from "dbo_angels"."product_analytics"."sn_clientkyc" ) c on a.client_code=c.party_code
where a.client_code='A901918' and  a.status <> 'ORDER_REJECTED'
)

select sum(amount),investment_type from cte group by 2

-----------------------Currentvalue
select distinct a.client_code,a.current_value,a.scheme_code,b.scheme_plan,c.user_type,c.city,c.state,c.nation,a.dt,a.Month,a.year from 
(select distinct client_code, current_value,scheme_code , dt, date_trunc('month',dt::Date) as Month,substring(date_trunc('year',dt::Date),1,4) as year 
from dbo_wms_s3.portfolio_holding 
where (client_code,date_trunc('month',dt::Date),dt) in (select client_code,date_trunc('month',dt::Date),max(dt) as dt from dbo_wms_s3.portfolio_holding  where client_code='A901918' 
group by 1,2)
) a 
LEFT JOIN (select distinct scheme_code,scheme_plan from "dbo_angels"."dbo_wms"."scheme_plan") b on a.scheme_code=b.scheme_code
LEFT JOIN (Select distinct party_code,case when b2c='Y' then 'B2C' when b2c='N' then 'B2B' else NULL END as user_type,city,state,nation from "dbo_angels"."product_analytics"."sn_clientkyc") c on a.client_code=c.party_code



